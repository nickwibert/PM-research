data_dir <- "C:/Users/nickw/OneDrive/Desktop/UF/Undergrad Research/PM-research/data/Annual"
years <- 2000:2017
names <- c("BC", "NH4", "NIT", "OM", "SO4", "SOIL", "SS")
usa <- readOGR("C:/Users/nickw/OneDrive/Desktop/UF/Undergrad Research/PM-research/data/cb_2018_us_nation_5m.shp")
# crop to lower 48 states
e <- as(extent(-125, -66, 24, 50), 'SpatialPolygons')
crs(e) <- "+proj=longlat +datum=WGS84 +no_defs"
usa <- crop(usa,e)
#1. coerce to points, then to data frame
# names are Lines.NR Lines.ID Line.NR coords.x1 coords.x2
## start here for polys
lin <- as(usa, "SpatialLinesDataFrame")
## start here for lines
pts <- as.data.frame(as(lin, "SpatialPointsDataFrame"))
#3. convert to data frame
# names are        long      lat order  hole piece  id group
dpts <- ggplot2::fortify(usa)
x.usa <- dpts$long
y.usa <- dpts$lat
for (year in years)
{
files <-
}
data_dir <- "C:/Users/nickw/OneDrive/Desktop/UF/Undergrad Research/PM-research/data/Annual"
years <- 2000:2017
names <- c("BC", "NH4", "NIT", "OM", "SO4", "SOIL", "SS")
usa <- readOGR("C:/Users/nickw/OneDrive/Desktop/UF/Undergrad Research/PM-research/data/cb_2018_us_nation_5m.shp")
# crop to lower 48 states
e <- as(extent(-125, -66, 24, 50), 'SpatialPolygons')
crs(e) <- "+proj=longlat +datum=WGS84 +no_defs"
usa <- crop(usa,e)
#1. coerce to points, then to data frame
# names are Lines.NR Lines.ID Line.NR coords.x1 coords.x2
## start here for polys
lin <- as(usa, "SpatialLinesDataFrame")
## start here for lines
pts <- as.data.frame(as(lin, "SpatialPointsDataFrame"))
#3. convert to data frame
# names are        long      lat order  hole piece  id group
dpts <- ggplot2::fortify(usa)
x.usa <- dpts$long
y.usa <- dpts$lat
year <- 2000
files <- c()
# get annual data for all components in the current year
for (name in names)
{
files <- append(files,
file.path(data_dir,name,
list.files(path = file.path(data_dir, name),
pattern=paste(year, "12.nc", sep=""))))
}
r <- stack(files)
# crop raster layers to bounded box of USA
e <- as(extent(-124.848974, -66.885444, 24.396308, 49.384358), 'SpatialPolygons')
crs(e) <- "+proj=longlat +datum=WGS84 +no_defs"
r <- crop(r, e)
# take a random sample of only 1% of the data
r.sample <- as.data.frame(sampleRandom(r, size=(dim(r)[1]*dim(r)[2]*0.01),
xy=TRUE, na.rm=TRUE))
x <- r.sample[,1]
y <- r.sample[,2]
xy <- data.frame(x,y)
coordinates(xy) = ~x + y
proj4string(xy) = proj4string(usa)
ov <- over(xy, as(usa,"SpatialPolygons"))
r.sample <- data.frame(r.sample, inUSA = ov)
r.final <- r.sample[complete.cases(r.sample),]
# perform k-means clustering, store cluster id in data frame
usa.kmeans <- kmeans(r.final[,-c(1,2,10)], 5)
# plot data points where color is determined by cluster
plot(r.final$x, r.final$y, col = usa.kmeans$cluster,
xlab = "Latitude", ylab = "Longitude",
main = "K-Means Clustering for 2000 (using all components)",
pch=1, cex.main=0.8, cex.lab = 0.7, cex.axis = 0.6, cex=0.8)
lines(usa)
legend(-126, 35, legend=sort(unique(usa.kmeans$cluster)),
col = sort(unique(usa.kmeans$cluster)), pch = 19, cex = 0.7)
# Heatmap
centers <- usa.kmeans$centers
centers <- cbind(centers, rowSums(centers))
colnames(centers)[8] <- "Total"
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab="Cluster", ylab="Component")
library(RColorBrewer)
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = heat.colors)
heat.colors
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = heat.colors())
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = heat.colors(5))
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = heat.colors(6))
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = heat.colors(20))
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = heat.colors(10))
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = heat.colors(15))
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = heat.colors(3)))
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = heat.colors(3))
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = heat.colors(2))
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = heat.colors(3))
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = heat.colors(4))
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = heat.colors(5))
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = heat.colors(6))
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component")
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = heat.colors(12))
centers
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = viridis(12))
library(ggplot2)
names
rbind(names, "Total")
cbind(names, "Total")
append(names, "Total")
rownames(centers)
centers
colnames(centersS)
colnames(centers)
ggplot(centers, aes(rownames(centers), colnames(centers))) + geom_tile()
centers
as.data.frame(centers)
centers.df <- as.data.frame(centers)
rownames(centers.df)
colnames(centers.df)
ggplot(centers.df, aes(rownames(centers.df), colnames(centers.df))) + geom_tile()
ggplot(centers.df, aes(rownames(centers.df), colnames(centers.df), fill = heat.colors(6)))) + geom_tile()
ggplot(centers.df, aes(rownames(centers.df), colnames(centers.df), fill = heat.colors(6))) + geom_tile()
ggplot(centers.df) + geom_tile()
ggplot(centters.df, aes(rownames(centers.df), colnames(centers.df)))
ggplot(centers.df, aes(rownames(centers.df), colnames(centers.df)))
rownames(centers.df)
colnames(centers.df)
centers.df
ggplot(centers.df, aes(rownames(centers.df), rownames(centers.df)))
ggplot(centers.df, aes(rownames(centers.df), rownames(centers.df))) + geom_tile()
heatmap(t(centers))
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = heat.colors(12))
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = heat_hcl(12))
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = terrain.colors(12))
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = brewer.pal(12, "Blues"))
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = brewer.pal(9, "Blues"))
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = brewer.pal(9, "OrRd"))
heatmap(t(centers))
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = brewer.pal(9, "OrRd"))
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = brewer.pal(10, "OrRd"))
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = brewer.pal(9, "OrRd"))
centers
min(centers)
max(centers)
?seq
seq(min(centers), max(centers), length.out=9)
max(centers)
legend(x = "bottomright", legend=seq(min(centers),max(centers), length.out=9),)
legend(x = "bottomright", legend=seq(min(centers),max(centers), length.out=9),
col=brewer.pal(9, "OrRd"))
legend(x = "bottomright", legend=seq(min(centers),max(centers), length.out=9),
col=brewer.pal(9, "OrRd"), pch = 10)
legend(x = "bottomright", legend=seq(min(centers),max(centers), length.out=9),
col=brewer.pal(9, "OrRd"), pch = 11)
legend(x = "bottomright", legend=seq(min(centers),max(centers), length.out=9),
col=brewer.pal(9, "OrRd"), pch = 12)
legend(x = "bottomright", legend=seq(min(centers),max(centers), length.out=9),
col=brewer.pal(9, "OrRd"), pch = 13)
legend(x = "bottomright", legend=seq(min(centers),max(centers), length.out=9),
col=brewer.pal(9, "OrRd"), pch = 14)
legend(x = "bottomright", legend=seq(min(centers),max(centers), length.out=9),
col=brewer.pal(9, "OrRd"), pch = 15)
legend(x = "bottomright", legend=seq(min(centers),max(centers), length.out=9),
col=brewer.pal(9, "OrRd"), pch = 15, cex = 0.8)
legend(x = "bottomright", legend=seq(min(centers),max(centers), length.out=9),
col=brewer.pal(9, "OrRd"), pch = 15, cex.lab = 0.8)
legend(x = "bottomright", legend=seq(min(centers),max(centers), length.out=9),
col=brewer.pal(9, "OrRd"), pch = 15, cex = 1.2)
seq(round(min(centers),2), round(max(centers),2), length.out=9)
round(seq(min(centers), max(centers), length.out=9),2)
round(seq(min(centers), max(centers), length.out=9),1)
legend(x = "bottomright", legend=round(seq(min(centers),max(centers), length.out=9),2),
col=brewer.pal(9, "OrRd"), pch = 15, cex = 1.2)
legend(x = "bottomright", legend=round(seq(min(centers),max(centers), length.out=9),1),
col=brewer.pal(9, "OrRd"), pch = 15, cex = 1.2)
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = brewer.pal(9, "OrRd"))
legend(x = "bottomright", legend=round(seq(min(centers),max(centers), length.out=9),1),
col=brewer.pal(9, "OrRd"), pch = 15, cex = 0.9)
legend(x = "bottomright", legend=round(seq(min(centers),max(centers), length.out=9),1),
col=brewer.pal(9, "OrRd"), pch = 15)
legend(x = "bottomright", legend=round(seq(min(centers),max(centers), length.out=9),1),
col=brewer.pal(9, "OrRd"), pch = 15, cex = 1.2)
legend(x = "bottomright", legend=round(seq(min(centers),max(centers), length.out=9),1),
col=brewer.pal(9, "OrRd"), pch = 15, cex = 0.7)
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = brewer.pal(9, "OrRd"))
legend(x = "bottomright", legend=round(seq(min(centers),max(centers), length.out=9),1),
col=brewer.pal(9, "OrRd"), pch = 15, cex = 0.7)
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = brewer.pal(9, "OrRd"))
legend(x = "bottomright", legend=round(seq(min(centers),max(centers), length.out=9),1),
col=brewer.pal(9, "OrRd"), pch = 15)
legend(x = "bottomright", legend=round(seq(min(centers),max(centers), length.out=9),1),
col=brewer.pal(9, "OrRd"), pch = 15, pt.cex=10)
legend(x = "bottomright", legend=round(seq(min(centers),max(centers), length.out=9),1),
col=brewer.pal(9, "OrRd"), pch = 15, pt.cex=15)
legend(x = "bottomright", legend=round(seq(min(centers),max(centers), length.out=9),1),
col=brewer.pal(9, "OrRd"), pch = 15, pt.cex=5)
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = brewer.pal(9, "OrRd"))
legend(x = "bottomright", legend=round(seq(min(centers),max(centers), length.out=9),1),
col=brewer.pal(9, "OrRd"), pch = 15, pt.cex=5)
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = brewer.pal(9, "OrRd"))
legend(x = "bottomright", legend=round(seq(min(centers),max(centers), length.out=9),1),
col=brewer.pal(9, "OrRd"), pch = 15, pt.cex=4)
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = brewer.pal(9, "OrRd"))
legend(x = "bottomright", legend=round(seq(min(centers),max(centers), length.out=9),1),
col=brewer.pal(9, "OrRd"), pch = 15, pt.cex=3)
rm(list=ls())
data_dir <- "C:/Users/nickw/OneDrive/Desktop/UF/Undergrad Research/PM-research/data/Annual"
years <- 2000:2017
names <- c("BC", "NH4", "NIT", "OM", "SO4", "SOIL", "SS")
usa <- readOGR("C:/Users/nickw/OneDrive/Desktop/UF/Undergrad Research/PM-research/data/cb_2018_us_nation_5m.shp")
# crop to lower 48 states
e <- as(extent(-125, -66, 24, 50), 'SpatialPolygons')
crs(e) <- "+proj=longlat +datum=WGS84 +no_defs"
usa <- crop(usa,e)
#1. coerce to points, then to data frame
# names are Lines.NR Lines.ID Line.NR coords.x1 coords.x2
## start here for polys
lin <- as(usa, "SpatialLinesDataFrame")
## start here for lines
pts <- as.data.frame(as(lin, "SpatialPointsDataFrame"))
#3. convert to data frame
# names are        long      lat order  hole piece  id group
dpts <- ggplot2::fortify(usa)
x.usa <- dpts$long
y.usa <- dpts$lat
for (year in years)
{
files <- c()
# get annual data for all components in the current year
for (name in names)
{
files <- append(files,
file.path(data_dir,name,
list.files(path = file.path(data_dir, name),
pattern=paste(year, "12.nc", sep=""))))
}
r <- stack(files)
# crop raster layers to bounded box of USA
e <- as(extent(-124.848974, -66.885444, 24.396308, 49.384358), 'SpatialPolygons')
crs(e) <- "+proj=longlat +datum=WGS84 +no_defs"
r <- crop(r, e)
# take a random sample of only 1% of the data
r.sample <- as.data.frame(sampleRandom(r, size=(dim(r)[1]*dim(r)[2]*0.01),
xy=TRUE, na.rm=TRUE))
x <- r.sample[,1]
y <- r.sample[,2]
xy <- data.frame(x,y)
coordinates(xy) = ~x + y
proj4string(xy) = proj4string(usa)
ov <- over(xy, as(usa,"SpatialPolygons"))
r.sample <- data.frame(r.sample, inUSA = ov)
r.final <- r.sample[complete.cases(r.sample),]
# perform k-means clustering, store cluster id in data frame
usa.kmeans <- kmeans(r.final[,-c(1,2,10)], 5)
# plot data points where color is determined by cluster
plot(r.final$x, r.final$y, col = usa.kmeans$cluster,
xlab = "Latitude", ylab = "Longitude",
main = paste("K-Means Clustering for ", year, sep=""),
pch=1, cex.main=0.8, cex.lab = 0.7, cex.axis = 0.6, cex=0.8)
lines(usa)
legend(-126, 35, legend=sort(unique(usa.kmeans$cluster)),
col = sort(unique(usa.kmeans$cluster)), pch = 19, cex = 0.7)
# Heatmap
centers <- usa.kmeans$centers
centers <- cbind(centers, rowSums(centers))
colnames(centers)[8] <- "Total"
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = brewer.pal(9, "OrRd"))
legend(x = "bottomright", legend=round(seq(min(centers),max(centers), length.out=9),1),
col=brewer.pal(9, "OrRd"), pch = 15, pt.cex=4)
rm(list=c("files", "r.sample", "r.final", "centers", "r", "ov", "usa.kmeans", "xy"))
}
rm(list=ls())
data_dir <- "C:/Users/nickw/OneDrive/Desktop/UF/Undergrad Research/PM-research/data/Annual"
years <- 2000:2017
names <- c("BC", "NH4", "NIT", "OM", "SO4", "SOIL", "SS")
usa <- readOGR("C:/Users/nickw/OneDrive/Desktop/UF/Undergrad Research/PM-research/data/cb_2018_us_nation_5m.shp")
# crop to lower 48 states
e <- as(extent(-125, -66, 24, 50), 'SpatialPolygons')
crs(e) <- "+proj=longlat +datum=WGS84 +no_defs"
usa <- crop(usa,e)
#1. coerce to points, then to data frame
# names are Lines.NR Lines.ID Line.NR coords.x1 coords.x2
## start here for polys
lin <- as(usa, "SpatialLinesDataFrame")
## start here for lines
pts <- as.data.frame(as(lin, "SpatialPointsDataFrame"))
#3. convert to data frame
# names are        long      lat order  hole piece  id group
dpts <- ggplot2::fortify(usa)
x.usa <- dpts$long
y.usa <- dpts$lat
for (year in years)
{
files <- c()
# get annual data for all components in the current year
for (name in names)
{
files <- append(files,
file.path(data_dir,name,
list.files(path = file.path(data_dir, name),
pattern=paste(year, "12.nc", sep=""))))
}
r <- stack(files)
# crop raster layers to bounded box of USA
e <- as(extent(-124.848974, -66.885444, 24.396308, 49.384358), 'SpatialPolygons')
crs(e) <- "+proj=longlat +datum=WGS84 +no_defs"
r <- crop(r, e)
# take a random sample of only 1% of the data
r.sample <- as.data.frame(sampleRandom(r, size=(dim(r)[1]*dim(r)[2]*0.01),
xy=TRUE, na.rm=TRUE))
x <- r.sample[,1]
y <- r.sample[,2]
xy <- data.frame(x,y)
coordinates(xy) = ~x + y
proj4string(xy) = proj4string(usa)
ov <- over(xy, as(usa,"SpatialPolygons"))
r.sample <- data.frame(r.sample, inUSA = ov)
r.final <- r.sample[complete.cases(r.sample),]
# perform k-means clustering, store cluster id in data frame
usa.kmeans <- kmeans(r.final[,-c(1,2,10)], 5)
# plot data points where color is determined by cluster
plot(r.final$x, r.final$y, col = usa.kmeans$cluster,
xlab = "Latitude", ylab = "Longitude",
main = paste("K-Means Clustering for ", year, sep=""),
pch=1, cex.main=0.8, cex.lab = 0.7, cex.axis = 0.6, cex=0.8)
lines(usa)
legend(-126, 35, legend=sort(unique(usa.kmeans$cluster)),
col = sort(unique(usa.kmeans$cluster)), pch = 19, cex = 0.7)
# Heatmap
centers <- usa.kmeans$centers
centers <- cbind(centers, rowSums(centers))
colnames(centers)[8] <- "Total"
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = brewer.pal(9, "OrRd"))
legend(x = "bottomright", legend=round(seq(min(centers),max(centers), length.out=9),1),
col=brewer.pal(9, "OrRd"), pch = 15, pt.cex=4)
rm(list=c("files", "r.sample", "r.final", "centers", "r", "ov", "usa.kmeans", "xy"))
}
# get annual data for all components in the current year
for (name in names)
{
files <- append(files,
file.path(data_dir,name,
list.files(path = file.path(data_dir, name),
pattern=paste(year, "12.nc", sep=""))))
}
data_dir <- "C:/Users/nickw/OneDrive/Desktop/UF/Undergrad Research/PM-research/data/Annual"
years <- 2013:2016
names <- c("BC", "NH4", "NIT", "OM", "SO4", "SOIL", "SS")
usa <- readOGR("C:/Users/nickw/OneDrive/Desktop/UF/Undergrad Research/PM-research/data/cb_2018_us_nation_5m.shp")
# crop to lower 48 states
e <- as(extent(-125, -66, 24, 50), 'SpatialPolygons')
crs(e) <- "+proj=longlat +datum=WGS84 +no_defs"
usa <- crop(usa,e)
#1. coerce to points, then to data frame
# names are Lines.NR Lines.ID Line.NR coords.x1 coords.x2
## start here for polys
lin <- as(usa, "SpatialLinesDataFrame")
## start here for lines
pts <- as.data.frame(as(lin, "SpatialPointsDataFrame"))
#3. convert to data frame
# names are        long      lat order  hole piece  id group
dpts <- ggplot2::fortify(usa)
x.usa <- dpts$long
y.usa <- dpts$lat
for (year in years)
{
files <- c()
# get annual data for all components in the current year
for (name in names)
{
files <- append(files,
file.path(data_dir,name,
list.files(path = file.path(data_dir, name),
pattern=paste(year, "12.nc", sep=""))))
}
r <- stack(files)
# crop raster layers to bounded box of USA
e <- as(extent(-124.848974, -66.885444, 24.396308, 49.384358), 'SpatialPolygons')
crs(e) <- "+proj=longlat +datum=WGS84 +no_defs"
r <- crop(r, e)
# take a random sample of only 1% of the data
r.sample <- as.data.frame(sampleRandom(r, size=(dim(r)[1]*dim(r)[2]*0.01),
xy=TRUE, na.rm=TRUE))
x <- r.sample[,1]
y <- r.sample[,2]
xy <- data.frame(x,y)
coordinates(xy) = ~x + y
proj4string(xy) = proj4string(usa)
ov <- over(xy, as(usa,"SpatialPolygons"))
r.sample <- data.frame(r.sample, inUSA = ov)
r.final <- r.sample[complete.cases(r.sample),]
# perform k-means clustering, store cluster id in data frame
usa.kmeans <- kmeans(r.final[,-c(1,2,10)], 5)
# plot data points where color is determined by cluster
plot(r.final$x, r.final$y, col = usa.kmeans$cluster,
xlab = "Latitude", ylab = "Longitude",
main = paste("K-Means Clustering for ", year, sep=""),
pch=1, cex.main=0.8, cex.lab = 0.7, cex.axis = 0.6, cex=0.8)
lines(usa)
legend(-126, 35, legend=sort(unique(usa.kmeans$cluster)),
col = sort(unique(usa.kmeans$cluster)), pch = 19, cex = 0.7)
# Heatmap
centers <- usa.kmeans$centers
centers <- cbind(centers, rowSums(centers))
colnames(centers)[8] <- "Total"
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = brewer.pal(9, "OrRd"))
legend(x = "bottomright", legend=round(seq(min(centers),max(centers), length.out=9),1),
col=brewer.pal(9, "OrRd"), pch = 15, pt.cex=4)
rm(list=c("files", "r.sample", "r.final", "centers", "r", "ov", "usa.kmeans", "xy"))
}
rm(list=ls())
data_dir <- "C:/Users/nickw/OneDrive/Desktop/UF/Undergrad Research/PM-research/data/Annual"
years <- 2013:2016
names <- c("BC", "NH4", "NIT", "OM", "SO4", "SOIL", "SS")
usa <- readOGR("C:/Users/nickw/OneDrive/Desktop/UF/Undergrad Research/PM-research/data/cb_2018_us_nation_5m.shp")
# crop to lower 48 states
e <- as(extent(-125, -66, 24, 50), 'SpatialPolygons')
crs(e) <- "+proj=longlat +datum=WGS84 +no_defs"
usa <- crop(usa,e)
#1. coerce to points, then to data frame
# names are Lines.NR Lines.ID Line.NR coords.x1 coords.x2
## start here for polys
lin <- as(usa, "SpatialLinesDataFrame")
## start here for lines
pts <- as.data.frame(as(lin, "SpatialPointsDataFrame"))
#3. convert to data frame
# names are        long      lat order  hole piece  id group
dpts <- ggplot2::fortify(usa)
x.usa <- dpts$long
y.usa <- dpts$lat
for (year in years)
{
files <- c()
# get annual data for all components in the current year
for (name in names)
{
files <- append(files,
file.path(data_dir,name,
list.files(path = file.path(data_dir, name),
pattern=paste(year, "12.nc", sep=""))))
}
r <- stack(files)
# crop raster layers to bounded box of USA
e <- as(extent(-124.848974, -66.885444, 24.396308, 49.384358), 'SpatialPolygons')
crs(e) <- "+proj=longlat +datum=WGS84 +no_defs"
r <- crop(r, e)
# take a random sample of only 1% of the data
r.sample <- as.data.frame(sampleRandom(r, size=(dim(r)[1]*dim(r)[2]*0.01),
xy=TRUE, na.rm=TRUE))
x <- r.sample[,1]
y <- r.sample[,2]
xy <- data.frame(x,y)
coordinates(xy) = ~x + y
proj4string(xy) = proj4string(usa)
ov <- over(xy, as(usa,"SpatialPolygons"))
r.sample <- data.frame(r.sample, inUSA = ov)
r.final <- r.sample[complete.cases(r.sample),]
# perform k-means clustering, store cluster id in data frame
usa.kmeans <- kmeans(r.final[,-c(1,2,10)], 5)
# plot data points where color is determined by cluster
plot(r.final$x, r.final$y, col = usa.kmeans$cluster,
xlab = "Latitude", ylab = "Longitude",
main = paste("K-Means Clustering for ", year, sep=""),
pch=1, cex.main=0.8, cex.lab = 0.7, cex.axis = 0.6, cex=0.8)
lines(usa)
legend(-126, 35, legend=sort(unique(usa.kmeans$cluster)),
col = sort(unique(usa.kmeans$cluster)), pch = 19, cex = 0.7)
# Heatmap
centers <- usa.kmeans$centers
centers <- cbind(centers, rowSums(centers))
colnames(centers)[8] <- "Total"
heatmap(t(centers), main = paste("Cluster Centers for ", year, sep=""),
xlab = "Cluster", ylab = "Component", col = brewer.pal(9, "OrRd"))
legend(x = "bottomright", legend=round(seq(min(centers),max(centers), length.out=9),1),
col=brewer.pal(9, "OrRd"), pch = 15, pt.cex=4)
rm(list=c("files", "r.sample", "r.final", "centers", "r", "ov", "usa.kmeans", "xy"))
}
